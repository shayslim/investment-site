<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChainAsset - Crypto Investment Platform</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ✅ Live Crypto Ticker -->
  <div class="crypto-ticker">
    <span id="btc-price">BTC: Loading...</span>
    <span id="eth-price">ETH: Loading...</span>
    <span id="sol-price">SOL: Loading...</span>
    <span id="xrp-price">XRP: Loading...</span>
    <span id="usdt-price">USDT: Loading...</span>
    <span id="bnb-price">BNB: Loading...</span>
    <span id="doge-price">DOGE: Loading...</span>
    <span id="trx-price">TRX: Loading...</span>
    <span id="ada-price">ADA: Loading...</span>
    <span id="shib-price">SHIB: Loading...</span>
    <span id="link-price">LINK: Loading...</span>
  </div>

  <!-- ✅ Main Content -->
  <main>
    <h1>Welcome to ChainAsset</h1>

    <div class="form-section">
      <label for="coin">Select Coin:</label>
      <select id="coin">
        <option value="bitcoin">Bitcoin</option>
        <option value="ethereum">Ethereum</option>
        <option value="solana">Solana</option>
      </select>

      <label for="amount">Amount (USD):</label>
      <input type="number" id="amount" placeholder="Enter amount" />
      <button onclick="invest()">Invest</button>
    </div>

    <h2>Your Investments</h2>
    <ul id="investment-list"></ul>
  </main>

  <!-- ✅ Script -->
  <script>
    const BASE_URL = 'https://investement-backend.onrender.com';

    async function updateCryptoPrices() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,ripple,tether,binancecoin,dogecoin,tron,cardano,shiba-inu,chainlink&vs_currencies=usd');
        const data = await res.json();

        document.getElementById('btc-price').innerText = `BTC: $${data.bitcoin.usd}`;
        document.getElementById('eth-price').innerText = `ETH: $${data.ethereum.usd}`;
        document.getElementById('sol-price').innerText = `SOL: $${data.solana.usd}`;
        document.getElementById('xrp-price').innerText = `XRP: $${data.ripple.usd}`;
        document.getElementById('usdt-price').innerText = `USDT: $${data.tether.usd}`;
        document.getElementById('bnb-price').innerText = `BNB: $${data.binancecoin.usd}`;
        document.getElementById('doge-price').innerText = `DOGE: $${data.dogecoin.usd}`;
        document.getElementById('trx-price').innerText = `TRX: $${data.tron.usd}`;
        document.getElementById('ada-price').innerText = `ADA: $${data.cardano.usd}`;
        document.getElementById('shib-price').innerText = `SHIB: $${data['shiba-inu'].usd}`;
        document.getElementById('link-price').innerText = `LINK: $${data.chainlink.usd}`;
      } catch (err) {
        console.error('Error fetching crypto prices:', err);
      }
    }

    async function invest() {
      const coin = document.getElementById('coin').value;
      const amount = parseFloat(document.getElementById('amount').value);
      if (!amount || amount <= 0) {
        alert('Please enter a valid amount.');
        return;
      }

      try {
        const priceRes = await fetch(`${BASE_URL}/api/price/${coin}`);
        const priceData = await priceRes.json();
        const price = priceData[coin].usd;

        await fetch(`${BASE_URL}/api/invest`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ coin, amount, priceAtInvestment: price })
        });

        loadInvestments();
      } catch (err) {
        alert('Error making investment. Please try again.');
        console.error(err);
      }
    }

    async function loadInvestments() {
      try {
        const res = await fetch(`${BASE_URL}/api/investments`);
        const data = await res.json();
        const list = document.getElementById('investment-list');
        list.innerHTML = '';

        data.forEach(inv => {
          const li = document.createElement('li');
          li.innerText = `${inv.coin.toUpperCase()}: $${inv.amount} @ $${inv.priceAtInvestment} on ${new Date(inv.date).toLocaleString()}`;
          list.appendChild(li);
        });
      } catch (err) {
        console.log('Error loading investments', err);
      }
    }

    // Load data on page load and update prices every 60s
    window.onload = () => {
      updateCryptoPrices();
      loadInvestments();
      setInterval(updateCryptoPrices, 60000);
    };
  </script>
</body>
</html>
